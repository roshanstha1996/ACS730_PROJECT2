1. Directory and File Structure (to create locally)
text
acs730-final-project/
 ├── README.md
 ├── main.tf
 ├── variables.tf
 ├── outputs.tf
 ├── provider.tf
 ├── envs/
 │    ├── dev.tfvars
 │    ├── staging.tfvars
 │    └── prod.tfvars
 ├── modules/
 │    ├── network/
 │    │     ├── main.tf
 │    │     ├── variables.tf
 │    │     └── outputs.tf
 │    ├── alb/
 │    │     ├── main.tf
 │    │     ├── variables.tf
 │    │     └── outputs.tf
 │    ├── launch_template/
 │    │     ├── main.tf
 │    │     ├── variables.tf
 │    │     └── outputs.tf
 │    ├── asg/
 │    │     ├── main.tf
 │    │     ├── variables.tf
 │    │     └── outputs.tf
 │    └── security/
 │          ├── main.tf
 │          ├── variables.tf
 │          └── outputs.tf
 └── web/
      ├── index.html
      └── images/
            └── sample.jpg (add any dummy image)
2. Full Code For All Files
provider.tf
text
provider "aws" {
  region = "ca-central-1" # Change if needed
  # Credentials are auto-picked up by AWS Academy/Cloud9 (use profile if needed)
}

terraform {
  required_version = ">= 1.1.0"
  backend "s3" {
    # S3 bucket and key will be set per environment
  }
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}
variables.tf
text
variable "environment" { type = string }
variable "vpc_cidr" { type = string }
variable "instance_count" { type = number }
variable "instance_type" { type = string }
main.tf
text
module "network" {
  source               = "./modules/network"
  environment          = var.environment
  vpc_cidr             = var.vpc_cidr
}

module "security" {
  source       = "./modules/security"
  vpc_id       = module.network.vpc_id
}

module "alb" {
  source               = "./modules/alb"
  vpc_id               = module.network.vpc_id
  public_subnets       = module.network.public_subnets
  alb_sg_id            = module.security.alb_sg_id
  ec2_sg_id            = module.security.ec2_sg_id
}

module "launch_template" {
  source            = "./modules/launch_template"
  environment       = var.environment
  web_bucket        = aws_s3_bucket.web.id
  ec2_sg_id         = module.security.ec2_sg_id
  instance_type     = var.instance_type
  user_data_file    = "${path.module}/web/index.html" # Path to static page
}

module "asg" {
  source                = "./modules/asg"
  launch_template_id    = module.launch_template.launch_template_id
  public_subnets        = module.network.public_subnets
  desired_capacity      = var.instance_count
  min_size              = 1
  max_size              = 4
  alb_target_group_arn  = module.alb.target_group_arn
}
outputs.tf
text
output "alb_dns" {
  value = module.alb.dns_name
  description = "ALB DNS endpoint"
}
Environment Files in envs/
dev.tfvars
text
environment    = "dev"
vpc_cidr       = "10.100.0.0/16"
instance_count = 2
instance_type  = "t3.micro"
staging.tfvars
text
environment    = "staging"
vpc_cidr       = "10.200.0.0/16"
instance_count = 3
instance_type  = "t3.small"
prod.tfvars
text
environment    = "prod"
vpc_cidr       = "10.250.0.0/16"
instance_count = 3
instance_type  = "t3.medium"
Module: Network (modules/network/)
main.tf

text
resource "aws_vpc" "this" {
  cidr_block = var.vpc_cidr
  tags = {
    Name = "${var.environment}-vpc"
  }
}

resource "aws_subnet" "public" {
  count      = 3
  cidr_block = cidrsubnet(var.vpc_cidr, 8, count.index)
  vpc_id     = aws_vpc.this.id
  availability_zone = element(data.aws_availability_zones.available.names, count.index)
  map_public_ip_on_launch = true
  tags = {
    Name = "${var.environment}-public-${count.index}"
  }
}

data "aws_availability_zones" "available" {}

resource "aws_internet_gateway" "this" {
  vpc_id = aws_vpc.this.id
  tags = {
    Name = "${var.environment}-igw"
  }
}

resource "aws_route_table" "public" {
  vpc_id = aws_vpc.this.id
  tags = {
    Name = "${var.environment}-public-rt"
  }
}

resource "aws_route" "internet_access" {
  route_table_id         = aws_route_table.public.id
  destination_cidr_block = "0.0.0.0/0"
  gateway_id             = aws_internet_gateway.this.id
}

resource "aws_route_table_association" "public" {
  count          = 3
  subnet_id      = aws_subnet.public[count.index].id
  route_table_id = aws_route_table.public.id
}

output "vpc_id" { value = aws_vpc.this.id }
output "public_subnets" {
  value = [for s in aws_subnet.public : s.id]
}
variables.tf

text
variable "environment" { type = string }
variable "vpc_cidr" { type = string }
outputs.tf

text
output "vpc_id" { value = aws_vpc.this.id }
output "public_subnets" { value = [for s in aws_subnet.public : s.id] }
Module: Security (modules/security/)
main.tf

text
resource "aws_security_group" "alb_sg" {
  name        = "alb-sg"
  vpc_id      = var.vpc_id
  description = "Allow HTTP inbound"

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

resource "aws_security_group" "ec2_sg" {
  name        = "ec2-sg"
  vpc_id      = var.vpc_id
  description = "EC2 access from ALB"

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    security_groups = [aws_security_group.alb_sg.id]
  }
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

output "alb_sg_id" { value = aws_security_group.alb_sg.id }
output "ec2_sg_id" { value = aws_security_group.ec2_sg.id }
variables.tf

text
variable "vpc_id" { type = string }
outputs.tf

text
output "alb_sg_id" { value = aws_security_group.alb_sg.id }
output "ec2_sg_id" { value = aws_security_group.ec2_sg.id }
Module: ALB (modules/alb/)
main.tf

text
resource "aws_lb" "this" {
  name               = "alb-${substr(uuid(), 0, 8)}"
  load_balancer_type = "application"
  subnets            = var.public_subnets
  security_groups    = [var.alb_sg_id]
}

resource "aws_lb_target_group" "this" {
  name     = "tg-${substr(uuid(), 0, 8)}"
  port     = 80
  protocol = "HTTP"
  vpc_id   = var.vpc_id

  health_check {
    path                = "/"
    unhealthy_threshold = 2
    healthy_threshold   = 2
    interval            = 15
    matcher             = "200"
  }
}

resource "aws_lb_listener" "http" {
  load_balancer_arn = aws_lb.this.arn
  port              = 80
  protocol          = "HTTP"
  default_action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.this.arn
  }
}

output "target_group_arn" { value = aws_lb_target_group.this.arn }
output "dns_name" { value = aws_lb.this.dns_name }
variables.tf

text
variable "vpc_id" { type = string }
variable "public_subnets" { type = list(string) }
variable "alb_sg_id" { type = string }
variable "ec2_sg_id" { type = string }
outputs.tf

text
output "target_group_arn" { value = aws_lb_target_group.this.arn }
output "dns_name" { value = aws_lb.this.dns_name }
Module: Launch Template (modules/launch_template/)
main.tf

text
data "aws_ami" "amazon_linux" {
  most_recent = true
  owners      = ["amazon"]
  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}
resource "aws_launch_template" "this" {
  name_prefix   = "lt-${var.environment}-"
  image_id      = data.aws_ami.amazon_linux.id
  instance_type = var.instance_type

  user_data = base64encode(templatefile("${path.module}/user-data.sh.tpl", {
    bucket_name = var.web_bucket
  }))

  vpc_security_group_ids = [var.ec2_sg_id]
}

output "launch_template_id" { value = aws_launch_template.this.id }
variables.tf

text
variable "environment" { type = string }
variable "web_bucket" { type = string }
variable "ec2_sg_id" { type = string }
variable "instance_type" { type = string }
outputs.tf

text
output "launch_template_id" { value = aws_launch_template.this.id }
user-data.sh.tpl (in same module):

bash
#!/bin/bash
yum update -y
yum install -y httpd aws-cli
systemctl enable httpd
systemctl start httpd
cd /var/www/html
aws s3 cp s3://${bucket_name}/index.html .
aws s3 cp s3://${bucket_name}/images/ ./images/ --recursive || mkdir images || true
chown apache:apache /var/www/html -R
Module: ASG (modules/asg/)
main.tf

text
resource "aws_autoscaling_group" "this" {
  name_prefix          = "asg-"
  max_size             = var.max_size
  min_size             = var.min_size
  desired_capacity     = var.desired_capacity
  vpc_zone_identifier  = var.public_subnets
  health_check_type    = "EC2"
  launch_template {
    id      = var.launch_template_id
    version = "$Latest"
  }
  target_group_arns = [var.alb_target_group_arn]
  tag {
    key                 = "Name"
    value               = "web-server"
    propagate_at_launch = true
  }
}

resource "aws_autoscaling_policy" "scale_out" {
  name                   = "scale-out"
  autoscaling_group_name = aws_autoscaling_group.this.name
  scaling_adjustment     = 1
  adjustment_type        = "ChangeInCapacity"
  cooldown               = 60
}

resource "aws_autoscaling_policy" "scale_in" {
  name                   = "scale-in"
  autoscaling_group_name = aws_autoscaling_group.this.name
  scaling_adjustment     = -1
  adjustment_type        = "ChangeInCapacity"
  cooldown               = 60
}

resource "aws_cloudwatch_metric_alarm" "cpu_high" {
  alarm_name          = "HighCPU"
  comparison_operator = "GreaterThanThreshold"
  evaluation_periods  = 2
  metric_name         = "CPUUtilization"
  namespace           = "AWS/EC2"
  period              = 60
  statistic           = "Average"
  threshold           = 10
  alarm_description   = "Scale out if CPU > 10% for 2 min"
  alarm_actions       = [aws_autoscaling_policy.scale_out.arn]
  dimensions = {
    AutoScalingGroupName = aws_autoscaling_group.this.name
  }
}

resource "aws_cloudwatch_metric_alarm" "cpu_low" {
  alarm_name          = "LowCPU"
  comparison_operator = "LessThanThreshold"
  evaluation_periods  = 2
  metric_name         = "CPUUtilization"
  namespace           = "AWS/EC2"
  period              = 60
  statistic           = "Average"
  threshold           = 5
  alarm_description   = "Scale in if CPU < 5% for 2 min"
  alarm_actions       = [aws_autoscaling_policy.scale_in.arn]
  dimensions = {
    AutoScalingGroupName = aws_autoscaling_group.this.name
  }
}
variables.tf

text
variable "launch_template_id" { type = string }
variable "public_subnets" { type = list(string) }
variable "desired_capacity" { type = number }
variable "min_size" { type = number }
variable "max_size" { type = number }
variable "alb_target_group_arn" { type = string }
outputs.tf (can be empty or output autoscaling group)

text
output "asg_id" { value = aws_autoscaling_group.this.id }
Static Website Content (web/)
index.html
xml
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ACS730 Final Project</title>
</head>
<body>
  <h1>Welcome to ACS730 Final Project!</h1>
  <h2>Group Members</h2>
  <ul>
    <li>Your Name</li>
    <li>Member 2</li>
    <li>Member 3</li>
    <li>Member 4</li>
  </ul>
  <h3>Here is a sample image from S3:</h3>
  <img src="images/sample.jpg" alt="Sample from S3" style="width:200px;">
</body>
</html>

README.md
(Write simple deployment instructions and credits)